using DistIN.Client;
using DistIN;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using DistIN.DistAN;

namespace TestApp_A
{
    internal class App : IDisposable
    {
        public const int INTERVAL_MS = 10;

        private static string identity = "demo0@192.168.1.201:5157";
        private static string privateKey = "5yScJchUsYPbsTVJPN6EK7dleJXAXnfsFAbZTuVt7gg|ixrStnaLizu740ZHf8zcNps5Dob44796oov0WzbsFHbWUJOmLd8VxhDvUlBY51yeMdZp432OoYi7uXxVi3137A|0xBuEwWQSoAw45ghQyKCYJJk4IaN2zKQikJs4IZwGkFCU0Yy06YpGQRoCRBRy7IknKgMJIdwVMIoyMQtICAGWBKMILcB0TAm0CJRoxAFSLaBYQaQISQtnLCEUBgFkiSAgYIxE8ABEAAAgzSKAEBE0sBsAMQR1JaJ0LYhEZANm0AKIalg2wIICQUsQphEHAEKS7JRSUgBw0aMoxYgIQkRALKNIJNwoqhRYIRBkKSEGyRJGjAtExZNIAltICcOTEgSohBCXDaKQLIw5EhKWQRymwIkQzgqJBlhIzJgFAkMZBYJwBBKERIQChaMYZBMFBEsIQlFEoQlEUkIi0CCVKJlzJhpisQlCUViWEAO2jhoxIApIRaSIjVBgEZyHLNxyiiQ4UJKWhgSYDYEU0JtWsIEoaglEsgxBCgB5DICAwkgWLRMU7RwkxZEETZy0aRNgoRkJLYpQjIGU0gxSggoS7JRADEqoEJJmiZuDCZAARZO2JCAA7CEGyURAsdhYCJG0SgA4qgE3EIOoIZsi8RxCxkE4rgoIkZF0raQyxgNGxBMoaKRGkMloqRk3AhQwoKBAqYoHIMIFDEIGBVQCDYBC7YACQhNG7EIkBaIGsZkEQAw4MZo0iYgYUQigwIpAjNsw6hkmTAQygSCY8BEFDcuyASK0UREnCBMgCBSSJBtAQaJCkJlCicioDAlE7ANoQBKErcoUgBgJLkNxIRIyAJNESliwzZkIzdlCheSlChk46iRwZhoUjhyichgIRRSoDQoSjYCWRgwirggy4YQgTYMw6Ao4KZhSahomJCQZDZEJMBxYrZNwzZFmMIRjEZCWQQpSjAEJKiIUrAlGrQNGQRFpECClAAOILFIGrJQChZsHDUFULRsELElRKAlzKIl0qBxDBki|YYRl4kRyjJhNTEJEIpBEkyIkGxFFAMkFG0IIiJZFCgQSkAANIElBSBYGg8Al3LKQAidSyIJNSzJgJLIxI0QqgQACCxlJyiQwAjhlAhWJwyZFQyRwmLYFgRAG2LJNkEZOmTgBJKmImgZg4pQE2YhsI6ZgEKMRC6ARE8JI04iE2ZgB2QBihJAJCTKJgsBRijJqIcaAo4QMxCgSGQGKpKhEIKgoCkQyk5QkA0ZR2wiFwDhSETVhXCZgigIJDAVoAqhBECeS0QBxiYIwCCOKAUJoisYwnDhtlEgCYhSE0CZx0wBRCcVwEBYQCrhwTCSNAQFpkEJsIbZB0khlU7Aw0jSNBKBAiqgR2cCAoAZBCwhImJBBIYQxA7FBAhlNCjUxEieRHKkxESJAIpAoQiZpA6dpxLSFELGFEggJgJBpCBEsIMAh4IRJ5DggygRsHAkMZIQQEQMF2MYp2bQAQEJSQCIkQkaQHAUQGTKEJJkJCZARQMBsCilpkMYwYBSF0SZS2CYCESQiESchySZMxEBloTAtSAAu2wJFEsRwiKKFG8KEygYim6YhC6KE24SMWrYsAKgkFISBUUQSE0gQHMUs4kIF5BBxnJCBnARRRIJEgAhEAyAwQ6KIRKYRkzgwoSQICjFxBDAoCKRhCkcuyKAty8QNlLiFmAQA0ZKNZCIR2LRwEEQNJKYEyiIuFAGMGqAwIiUM5BAh4yJm0pSICQmI2hJGW0BRERUJgIYMDEdl1KhpExGBGJgsjIRJoRImWEaRGicODIIpQRQAAgJRiaSNoRZSCTaKGTMIGJOIEIOMWCRyWRYBCyKBEUUhBAAAGAEpwJKJAydBkqgBGqAw3CJkQoBQYESIScIpYzgQIocIggIMERVmA0MR0TICGDQoIsJJE4kJCABmUggo4LARwSRkEMmAopCFCjRumAQwi5KIg4hMY7hlRBBsGiNAGBRxHCUOGZVJCZVFi8QsEQOCWxRiGBhICqhRETFKAJhRI8NIpAQsnDgQ4DZJIxRoDMSAmbQsITKE|xTDPWCz5x6YOfeD240C-CLve22JsVAtqb2gAbacNwIJExqSaBL05WKxsMc2tBe5PWDvgvqhvPej9LfMQnLTpZZu2E3IDcpxFbWIpXGPi7LbhTlbgAZSID9solCCtZZz23i2c3vx3YoMKciug7-Qr4sut_nch_omUhf6aQ8utbhJAXDhtWffeqxryFmqoVkTbNrFcBtXXZ4EROZo2z-k7u7nFnEdUEpOyyExv7QeOU403fmiCfpEnLBdRrhnTQoXNCzgTB-ZaQAEZl9V7ZxKtFJlJodOJueGK0FJyL3xeylFFRr4MjSgYTw4i4vGCko7dTq6KEJQiVrfAQcmn3I_00y1PzfSTZDJqueUVCOhW--J3RWRc2z_MJPCnttJ60DaJdf6ozyuZVytg-ahbb5wRWODrKPlwzPECTl9ZAq5CDx5_h-9TeEK_3fvQ4VNreMcU3kMAnqZUeYsfzY2wUVmdlTA31N95DehwhfaJmi0IatL2-36SV5TepLD-O0AoIuODeF5DuXpaxDSzpbgTbA-vkuKqYiKt52xmGS9yZWVkl2S20ALd8OdoGp_RNID2MPAFL3D0m9hvDKcz6HKJwqDsfJ6llIuyVS9Pzo3qsYBbsRVvmDDZ26HcmQ8PIJvT4h7OSvxjFZVkys8DnnJ44EPAbUE3h8wpQcLnrd0iebvhVliSpEupFoetG3LlSWONHFfKtd45P95RsXST7eWeDDO2LDYiDXU2Gh4lmwFi8MzSuqgaIXklqF-_oOhcX66_QSNbDZmQVbRAqgdSN1Gci49Z_qeGe4uuFOekj-EsQPorQ54lqzPp44JudwXvHS5wCCO-6GYE33z0wV7WI9ens26R-9hSzawDZOt1eAtX9dgOlysBRLk-oEjibfnKcZesV8_T5R44ieYxpnT27Y-b2JQJwbm-VpfcpdBjnddky9YLPL0e3asi5_fLm-pmQSLFISaFjG91eJu_2hQV-tH_lc6VHpgHLuHOIjNMjKqjS3kQ9lq-E0luKX83Mxe99mLN3a6TddHfBnGaauNEpzx4C9z-7EYOhVqplMDryokQeoDooSVcpgPduOgC42Rtwf-ERN-ogeCZ9eYxAFOxY0eJYIswZlANwiFWtBaQx_V15EkwKwUZ-FJEjYZX9IZ2JYXu8XXc1BKi0JBccDnDosWx1UsYiesyHivXYDZodpHpeDrTr_3CkoySWk43kg2qZWJOxNipMKL1DsGtPzKnUPPPtvRi1G5sl43u0LOJB0Hkb1QSs7B7MnIIbwOaWA4AI8S8kfzzHYDgYHEHfrh6pbJ-Z4Jl5aV1tojqgclJs4dEZ4g1zheKbdnYZFuQ8rObVKfT7y00NAuD5jhX4jgUHWhREEpMi9hCnDbaELMWgcPmAGtCswnO5Q571UgqBM6_osMaGLt4pL-AEoBjQAzA3DVb4EzwUs1QLFoosh9JRPnmiV-tr66zqM-AX_djn_AZnR6aLV8peCkOrPGt3hVwZYRBRUSdQHYUlncDMu6d4MHEN_LUQoL077_ZhvSwdIPU_ZmMjKVgwLt8AitJwv9oDHWeHhySc8TBCgyaQNc5-1qfHsTlRQde-WXqzbenz_21G7XpgEfwlOfNkZqAqulyZh1lAH1iioWUF6qF5YoCbHWBF72AelO_KS5p4cyvegHw7j1NUoyY4hFflmMKn4kmHp68sBk17aosxq1RHKsX1qL-SULPd4cjaj5rSvjJ3VIUH2wqqO6p4gNHMK2Gz68BU67WJJKmbSyXJGNJWqWWXSggJC9yisr9dlzTWtCmWMXqhOC9S-hEhbxx0Ujf7zFTzkWAt1R9yyzV4Zgmr5sADwrAAAOOEx8DeSHUmyDopQBOM0I_J18wSAyCSQvPyKPKNNFkejlCzF32woQtfSQOPf5tkbMXKmTBxqLhLHBJNv4NmQIlznvZep1X9O9EoYHp4EI1NOEV3eRUw0BYza07ZFpD1x2SnDhLmFbi89ZdR-ktQL1jd_U-sKe_k5X7DgCehDs7dUCiN8IqkhI6zrDsRTOTlszimFg0k_Mq5SoTZtYxzQw5KTy5Isdy7Hrsyfv00k9CoYWMlpSPobOKdvaLVr7F53he7isr9bDymbJgAp0sTY7RRr1xap-cqPrMhezkpyB1Xslw6sQynSenENRUQI-dkvjwH9NO2tSAlJXroQtZWCqfKznwg3PPrhTdmcK9HQMLd9rDjNseUHxGgnM-OzT1zjSmTVSE46UmQWzZwSUwBhkAB6OmXhDzo6kvwzZS7afj8Cl7az8JWUv-ASGP940HL4C0rsMg7SfF_qXGPy_CBdSQ2DGeyg_I8mr24KDibTgo4UfFr5b_nrbcAxX9Pm9N1Ax6VtOxWJOd0cUUe0nN5gtJXcLL2U4g5424L_Vvkk1aw8xoUhSRkvxNQyeNDGLzLdwkIM62H-HlLAmxGtSJ7MoHajuS0TfH9tv-pOEMSTVKEBcs9Uy7Yehna7_XPCIVpMFAnfGYNfdcBI0wwhxOpcNR0Pedq2Ov-7Xsa_9bFT7K1dN_KjEhN4DloNOj-0ZQxCso-an1_Nus_2fKaV24P7TyaX22ykyXKzgKWbCO6sORB4AtAmgyOTeWKY_JorS32aUYLWJcIlgZ57T1B5wdfmq4Er77AcAHav2MVVhLCgqsxCrqm3INPKHWDZ9-ssG5jzPVjJ5g8sqGeJMG8jEikc0HIVzfXaMpY-qn8xDhW9ba1s4eP7zssl9HNeik3jrMrlthwp0c2mN_bLam9Jo_YVGkv2XD7Rsk8rH32LKxlwNk-QlRYXm_YGKbsEQdezpT5nhrLYNhqgXXLVUkDPWFRaQcYt2e55agcnmTglh3tQs1mCK4QLrWlXEde1VCJEKY7ELf5fsz0TyzoHBqfRLvzpU5tyjcRWYs45F8isZiV1i9KlBoIvi87Cqc4ky9ynbPyBahComOti01-ShYWtRBiA0iXmkAfoGADpYGvSNJTkCNsn7sWoFYhH-hu1YnFSC_gMZLE1PQCHwlbxdxITyKAwIm_u3rwlYu3DOKU31fd4wU9irrUOy1Eyp-7axq_IP-kcCmcryOoDSbh8SbeTMaDuTFPDIRTRXVUPmOLZQg0i0g42LnOihjTkgVpzboogsDlI7Sv3eAIYYX8JaNm2VgD-tEX01I70_BemYPl7pGst-cv2zk2uKvWTAGGWd4If-Jb1VSVNJhW27SlZFOMCCakGMgFsubGJZi972gr5d15ARREIck2QqTdOmD872Oj9lp--vGg6EfmuPE36LvJPsfwtDI2C3kwIIRSbJrk69REsKFM31AhmlvOiZZFV8iWX7t3-Y9GzUgMfQPdsCePMTEEqMpcPvBVFNBvNZIiY9ZS5Ow_lxtju2rKAszC6JCuIW7reNi5glBYrdUFSjYcl91st3NH9Gl3wRgqmhZ4h5non8Y7T9eO0Z1fio3eLcArKTkrPdCVmYuhvndRogGUj6ostAjxOkoPhUZdHDIG_h-actxV1wr-i-qg0BZah6roh_qVHAqRZekzNh6dJHd5DkSGy_LnF-oS9TBPy25CojQH8lcKLT-3YcfNdOifxiYuYZ2GCRJBWgTXZnZlCjN_RkcCOEvv2hdxZgaQTAARAoCQfKQweH1gF0MEBe7-dNtPqRHYQ57pbmkrOml57Ji0Cf0wjaoLli4xmwokEj1cwix5aFsltnteaXW7ktwt15f-I1AuNCYSh3RVWabfyf9Od7AZSKx5o6F24NMxZGizNAUF8WA1rQNSfLLL5XlXOAZjFLhgk4sbVoQeZ0Fms6hfyhl6PBTHlSWRGiahmciP06Q_h9fud5WmAv6B7wzSsyaYbVA6Tin4GH5ZO6_eEx4L6JV238GdM_BG53CqiL1T6qgy8yzfNeCAFXwbvVht4Hi51C0gxDBXRi6-c77DA-kb7vAfjRQJFAe0udfz5G7uPsCZ1WsnTjB03U8xCKi6j7QQRRgvd5jt4_fk40so9VYzXmgddOdI4uZQ0nhEeFFeVj6IN-015gGlY3r3NnexuvFs4QnfcSJX7KZzD7maI-y4lACqF41oWzVM0Ab3m47jAbZyW4VkkMc1toSRikEwr6L11eOJKluWmg8LIb6j-8bgYrUcG6ykx7bw2RnGLgGBWSVc6UkRYYk2wu7Hy9SB8-LLLpqfJOFDX_bujeNvFvOHl3SdBZFGHoWXTCnyToheyd2ArtM4kqq4aewzl8t0SpzgbRiqz6_qpjTxW7uRuhGR-pfzeJU3aejZmtKVwyQafa_xwohx_NtHtdqvj28W08XVz7ey4v13CW4XtYlcS_55zsArtjxwpSS7v7mh7EEtQ2ejNo9kIxy0N8Sjzc-HYQdFamLIQUdkzgrCFExB5ZGw4R2WNPfLnDfeTdGCLmM8TQWYtjRdDv--QZAVPuK50GHnBD0Tll2M_WdvSUUIpOolIWyKNEbI14JhtuWCj9PdI4mU8EuLmadUw";
        private static string publicKey = "qqcT6GaPDfeeSIfYazxj3C8osyaWhPGjW3WTdTzkmA8|bnTTjYZDQlsqHlJe7sTQfIVWHzMCWZRyWfvp833mu_xhZZazW2sTtTsZcDf5b-OO_V7e5CK4leH4TvrpaUvORBro_PXZQi1edTrL1mSzMJqEQdsdN_5Ps_9UC5NY5sWdz8wLcVcQeTK0lsMUkA7zTK1rQUt-GuqAAQ2eqVPRN_vNRGNo_zQrdKoh9XlP3-X_79pGlQnPpSgYMveBOVWEidkqAgqwnGwdBcEvTZ77otFeBAJPOriw98dmFWfD0IrBGuXDtueMzYfSJOBK18j7a_kWNZg6Auc_hftIe4lCgkJNCL3_ecVzFw_LTOyn9gEN0EkyNYjuHrqoLr7BPA9enq201s0wz-DkYWfTqSG6nEY5LTnHRWK6f8eh-d2e_iZZyFAW9a98B08_oHTXB-gxXItdHNLN2w_xlfC41SVXU-U40MfsKZIYQe5nagb8XyXxo2QTi_EBYUIECvNN3d2Lc3viqLAGblew9ppkF10NV8NEQqdtMjznXISoaR9sM2H8a_XmAqO-SDQ5A9w-mmz4T_qj7muEANHvm2SC8uoLDaAtjKefr_RSypjUMlDvsQduVScsVbTdnfkJHuA5oC6wZj06I4uttJEpZcev0H7ir2jtJTR9kjXdWaW53smwkrbZkNvmLJY6zhzXQm3La6FRrjVYtzogDHuVBAXNGKsmNHF6-EuNNHb0EP28qrcooNIdzPXRVuBM7T6heTrPzzfqi_2Rwkb9BwteLnyLTWuTEjHTzZw6crGCIZMYSrbTC95zVM8s2X4g49Hk8NK7s1fYZklQqoWEA_Io6Mqm7u17KazTHGkE7FaFKHwv6Awx7PGZqB1lL_Fhv1T2FlHHRX5TYnyA3PflA0iLGjluozLCuqVV8J1CMgXJS9ZerFIX2VfIU0eJL646nzqB94rByWW9qadlWtsSq3RtbirD7ih0IB3W85Dd2g1X-k5HorrRdLt7QEL2V9jTYCgJYaIfRYf37RvLwlVOe2Ky_Hph1aHMFLCbmkBfYDACeClb3mLx69syBOwhDw9O9NVUFyoQS-_-Ws9u2_EhkH4zUNmMECXzN1_GCE3y5cot319HE4-mZQHrEpTCl3X6ZyIgiKM19t2qZe1lcCC6aN7glidrfNsswnaiKdPC3hDRst9_26jJ-MofhkMU0EsJAjAKbog2XLrzclgG6j35r8k2tKynBxPJj-brF5sUnV-Kr6oRn1aZMefDC1VSwOFJcCfBx1treMzsdNdmEpZgIrtU-ocHwPOoJdxgm2pFSDETRCt5j3HCTOr13md4RUZ2Yjq9dlRL7KaDdzOx0rIV2sFYmPmWuBUeeN8h1RKjjIA7ZHBTXRLvSER2f9LUAUQGWmbFNc53R1Yao4FbzICtyDmd4T82GLIg9jdW5pW_I7JxymMAp-06yS8NQHhUawdr1aTtHxeft5ZSEPGAPnIN3w1YZrwu2uJr8TPohv0NUTW8_g3HTSuzsAReKyGgCuDVlwJlhnaDjlV8Ma8E1SD1cMzvau1hEQ6LraXTzCe8yOPNYFfyd0LobS4fXrjZ4sGoW3eehamdeNyZuqXfmdLWUhNowLZjQ0vGsUm3YtnlAQ98v90ZLKcLo8VEjA8suJFlPS_5PG-jj0oX2mdby_eRL0_cFHYQpGNnrABdK_Sg2Yf8XCbtgTr9ph6V1bnFVSrSeo7NRIx56p6r_3N-XwwRkvaWLFMXvP-SILSu1dPlEQMn3VZfpUhr2OFhciRN_yXMgcRVOLFOjMD2MbqBS1JGoTomDlm7O2pYP1hXGJPC9FpmYoRFrPwdvLNgx9IQ1hqd7K0A6XWGEqcnQk17KsbunGih5P2yzYeY-b5ZUlceIEqkVxtgyXcm4_CHLejALuGCL_oAZXXYRVfvwbHEaLaCWQSpiywHs6TtjH1JDvhHSb99O1aEmLu_7X_PlgZlTqr2kRw-lwqo6hNkV0EBVIITwn9XGzbmbpQ0AX7z1_gY4_-HrJh-VgbWns_lJf0JqewZAekys-RnRV9DPHoeI5IMQWefSwsJ4PAqWCwKvHk0-ws6y_zbz2JE1VZ5jLZLrQ-qS-kCyuuMcraC71ggfMa4uurTouecPDk8mwN2BY-wwPoZKr4r0ZHnv-qc5CCp1eiFHM4W7lwCOWQevWIKfVBsaNHJ1JRnMz72T1OmtOOsFoCaKVvhGXuJ8bh3m8uQphgS6PESqgbHH0kQ3wiQj1q0ieXJGyXsweoBU5wy9y2REkGH7pjCQQNUosN6_XuDlKrbtAdEOS7MbqzWbeX9lzh7LMP7TqUA8jc2BXKUUu1g2MzZ02nuGXEwc2-AL-NFi1s1Uiv-Du5aTPt-L-Hm_UoqZrRuGr-K5COahEtME3pJoc2XOI8_rW2y8GGetbtgmobmbHtEE-nTnxkMJfTrO8kDTB3qwKKWNahzJQdHx0rC6pJ9A4IZoBJOZzXHEcAheeWRtSApY8ynTTDzOez-B0maTc_M92kY3rWcJtDZM69i6Zdy8C6VP55yGuxIS_fzkVYYy_QOXjZ8S5cY_Zoz-AamzIYBeoFo9VgGzIh-fCiTXNks1q9dil4QtN0syx5ZHRU2EL-y8jVVbEYCAwvi4jyf8mvT9ViKsnWEup5ZBUSu_OO8sFJiDueUNuPnSsGOP_6tVTvLwIMGiWOaYs9Glmv84z5cMTXhT9y4uvIqB3auAW0gLozKOxQIxRHc4hO-WoXltZdnGyl__t92J5iFa8V8C9SY2-Br7d4Yih7yg3sGul4I9I9AkVF_dl03IkXhbLDK4kUSxZ75CHOm8uGZgMxYj4J2Bt8f_LR8fou8IWAzYBfaA5ZZc46wJZi2txTSZVSOQw3jcIIkOAfs5PaGbWJHihJW_12PS9TthEF8RefoVZfFeWJ8UpsCKHuOauOsNTf12DnGXzGVhU4rJxcY-S8GFHD4syVUO2ZkeFxjqfQJcYyB3UXGaIwIEyHduft-33iQ8UCy7aRok5tbX9D6eWalgU8CxHsluZvTa5GhE_vy-SC9YakxldTcAgW0TDw4dWLmxMUehgzQOptgwCZoHoyqTnBH0FzzsdXLuSD2owFYeLCqgjXaJXjbHvSV7_9hkE3KYoy1_bX4QVJwk9Neoq_UyhndXbY5UMp9Up4Yc5N7wj3cqCN2qLWkOgAzpG2Nr1hgIE3y_xZhyvKrmY8ZBb9sqWhBx9P1GEuETaM40SZLdyH_TvIuVOGo-o-nXY_LclpS8e2WHMCx65W50DctJB1uQerc8Sl4nZ1IEgxsodm0jWN1biuT1skPY5Ur-IbQH4YS4556v8d1CrWg3oj6BGhcTvEYYcndKuz4c7IfmS66w92Cxn6C9Zh6taoFn-6l8m-w3_zZY5YDLww4tnI1UkUx38O6MzgZwtt_cJeamobqf2HIgTF0Z_aU4MQMr4Wgge_r8CLn_RRopg2p-g";

        private static string privateMsgKey = "BvxPoVgV8kYukdSkWVsdL8cxwdpUmowGIjcQ7ZtznLGnVBKUUes_B3BxhwKDCYWLX6ZTkyUN2vIUt0SUYhTDrYiPO-lVoilM1rgBiQtR_BHOQbuHiQAru-sa8Qonq_FF64ee6kkwDAuq1kczHpKW26OhMLww-ZU4xOKMfueCR3eVsQZroLHAl4sA0NWQ7lGMuEen7-EW66Odq9IAqSyvwtAN0yCfpdmt37pYkvxpLOJOKZOndTtZ3Zd_mcsZajpUOmFoyKiBIetfsFJAn5ZV53hUEujDKcJYKKEq0cpwV0IZ5UUnlHxUhgxksQiZYulZu2UVzCEuwvS8yKszwts-9cdgj0MuPlEOmTdWM1CTfXC40Kh44pZQ8vyXy9HL_2J-tBscV1aUzoo0KDZnM3GUpkXKOyRErTCdHxwhu_Aem0GN8dFurhuTnNQZjIWJNREObZqBoXPKSLkJSMFi0wKbHZuNNsJssiFU1ApkyMp3Bulf3PxTaDJVVZQrhJFDdCYmLhE2enlP2huwQwUtlCy8aLhINfVFlYJtYJDMnjMze_gKWSuALcNysnAICjB1zXg4cKO83jGvhJdU3ahAhGysLrVR-Ie6wCtxxMs_3lwrdMZ6l_BivSXFfhU7ISenA1ZzN8wh_-qxiHtfAeFoasNw_wMg_RVEpFgzXxMMORFr-ROFIFBtmLdbkDw1FhorCqoCdfFKkkJZO8kcqNCI19ZZS2tQwjlz52WWgLdXuaY7xuYi4JQDQLS6QtZgloAx-dLISZaA67as-juh-ixi46sEsTDL68UBjrAlt2he1IXFQvMa66U6VRAplEIWR9ifbFehV5aWGzUgg8wVJqcwENsix5hfD5akQpPIdTyrqIIDxGFpibluZQoxljuyDKYhYym1BLQv89i4NxA-kMq5s4tpayXBhSRuftjFv8qW6fxMv0PPEgeBDdcHFYlgmoBIFNmS9MyhrMmgqdQx3rZrCxhmv9dfzjemVPyDl1pZSzu9TNcJVBK-4EAUkjNwDHXAyJVFrYl3zjCHIFBZp6I3qlkbbnQDOBFGIkZKxKMol1MwnBxczHsjJgh7VwEAbguOI4Gw4YeORwjQq5M9YweZLsvLmYGKCsKDBKYmmJVGUXyHdsjBH9Gp-BS_qwMiWBx8CApkSGq5aCKGRSZhNiwRB9rIKrGVE2dbB9BXm8FmGvIyApF5hWRxP3QZTTJq4sSxW7S6V7s9tOgCSHJM1pc4TphjlSiBEiy6BcIsiai-OykMiHZ1_4sKKwBzytWftzKUehhGN7Ny1GpYENxrOgFuponJ1VoW3WujD8xqZhphSQnCXIce2WeCyyNxf9TNAhwIWwStU1mqdjABiKdcxkwfVTVnftZGv-NkVikeiiMClUM5StZGhVlva8ZpEBq108x3nsYFv8soRhe9eYWr44VDM1Qgh9Ut9QlPdZQqPvQWlkG41AmBXeMdZaF68rDGv4eor_jKotJk8oedL4U0viZ2eqM2RoZtLBk-NSiSYKAg9QY4beQb_9xMZqSuNVp04tBVUFgWSZZDFrU2nkTA5AODNwyEQCF4GjM5RGayppWvKtJJKsc8ZHOeNuSJF5gBQ4CZVWAF9VvPmUppytgkfrww5ZED9BZL-5ZIGGZBJ_uaXbOkiMhDfPZOEsq0SrZJ3Wl8C7fO4_ECczbLb2RM35wdNnvODiCRrsU6V3cbMuAhmTWOT8kyxLECo0RJFHUXEJQrKNZv5SeERRXARpxq2ppS-QpsT5WO1YM35ll5wCcrMmCdrclkLllAXFNClhIl4KIJE9mumKOSpQwcQRyDQGkykjeKvJVQRsSnZCIVOBjA18yhUgzNr2A4tBvOYIOM7vCugXN_Z9w_BncpbWFoUSI5u3Y1qpKA76IJhSeG0tLD5ao1GpkIQSVcs9ce1_EQhCI5a6ZeTiMv3Hi9vKOCeTnM1Qs6xmuPcAFzwWcm7nsVWpdxa5oTv7iBrDXDfqTMgti2fefIuWAaHio2FSy_eItcQmV8kZVG7TSmd2dmrMVMr-Q2yqK7mBwHrSObHVhQ-Fw6yHBg|tzXF6sLxAA0Hy2ASDYEFMm3buNJYOPcmncrlMgNgUy8|NWNIoF4-wPFlzOESHFaRf4KMm_bLmKh3cnuhbv1pMyc|5NRLD2GccLQdL4SwZuZNDdNZ5ydGAkghSzHPZ4N6a5gDhIOJCdkCvIF-4YOc5wMt5fkEaJGWi4O2-zhJvUNuiaysL_hmOXxgOiku5FhqIqIq1Sw9TnFO0MQUbsxZsyVz5se0FVqJMaU2ZCe2IdOSGARMQCpqtmBIzzaM32gvW1jMrbdNUKE6QjZ_1RQwGdRCM9gUZ_hHGCJ22jOQbBlAYXquHFab4uup51FEMZBsvOZ1v2RpXhcfS5MI-oHK2BvDZAt2LcyqPaCmEcWx16l2UffABQYWEBdex8o22_CUT4EJOweD4tGPa1YaHiJvFCF2fDoELJxDIWyp7vpWfiBtCpKaT0upbeUyUNNt0eUq0IPBJ9cPYzsn3Bk5piKEjJY-NmjJDmw0s5iFUGIrM6clXLYrGjByydh3gtSqZTQoXJdfc7bJQNhrTxQcKCITcVpwmlG1WFTLg9sYACgLZYkcNCR9WSIaimx2_PRfW8o6rZUlMRBhSEteO4IKgrgGYDoczziSLDoTUYdMCmQe3udjH6PB1HMTL3SU-StrreAckYd6k5hLCvs4-zIRyFM3AsYeS-sYyLocjIkakASq1KgcZUStOXpbyKckdKvNT3iQgNaIpTJ7I7fEjrKJV3kghDwNVhdX0dIWLmiXoTEvijVHXQqNbYlL4wILABGghtWGvzpbXxVgg_aHxCSfm0pKSKtjMdmTQsQyg8STLUxQfkWmdWt750tj8HEZ15YUZqhpswaJqNaE_XS7OSzAfdEj8jx_XkgWZ5aepNVo2VCICWlYIiQ-jxoZSEqzEbtKDGvFmsI8LVZJUKCqu3FIgbUg8xM-1PXEOLNuKqlh6UQXY3VdPSk7uwOIYrwFfKLB4GrBNNit2jPBU5qikWdBOtAFboOY9neWPOTCYrqxZtwa8KkLbBGsp0y6CTxhQRQUvIk-wWWDlPUCZbhu0jWXdHc_6SSKizOt-tKHdZzBq5lifCq_6ePM4pF7kUfIEwFiBvt4eMwokmo0KnGbD4hoh3mIvzfBnnNAJelTiPNPGjWkWLaQ_aB-5adASgApe-NJYEGdkNyMXdoqJ6pFX5aupnE6BcpFC7s8BRtZmapieFWVL2Q-TbgZbhUF7qYXlHhBS8hI07YQPRWfNQZ6Weu_2GeueQUzwGteBGOZfXtNZ1izsYAahDPHhvTH4kQm9SUgZRlNzdKK5QqulOooVRUfD7Zx4HaZOBebgQFEqzNDW0dgu0kzpzfKxFsJOHkxw1a_U0hGP5PMOpSJTgaeWLo8zFSgNzgKlBRyDBp4SmaZ-WVqqQGjgHMW_ZASQNE0ISIi7GOSVnZ8xfx9mOGS-zuGh-x0ELWd6Dp-RHMrZBq5uwY0CIegF4QDG8d_pfwntcReOFNpy0dqrFoW9iEFeteG--YjKyho5ZK8D3fFYJC17XseZqkddGwJCTNt79Qv89dGVVYmcDR87gWpXSJIKLUHCoYqqBqkxsSrpzwZvLF6OdgX9_N80YcqBOiRYJseELsbSLgdWvZ2cSuif0hG00uz11gpqcxwZqEvoiZiU8cYLfsYygQDPKZwiaIiJOO3IlkGjbWPviU354iLLogY23QEazBuapSWOXnGF7KajTt4Msc1lnQ88EJiYONYjfg20Ocb0zkOlGoymBORRsGUUFoAO3jGQum863MMLWKNTQNl7OEuUrhyVLYLT0Ck9jXOWaUbWhtoUYixVGgZUoeft7K0d3UBN6qbx-woXitlSrBjDHurDLU_auaJXqWXeyVLdiSOAmwYTzQY_1GT6yPDzZc8QbybOjx6WfcDpUp5MLG1_FBlGvLD9uq8_6Kq5_I3KNywFlRA_5wqn3gwEiM-EYWFzzyWb8thMmOKiEwrZBKWHRUPpHaNlhXCChMCwBtLU0wMEQQr9wOslOsdhzpvufZH1gasbkCliScArxZGEbQlS7K-8QIVVxkq6EcEf-dvaZu1lDorWJImsgc2o4G-AMMYmOuEusd2aWJae2w8_kSQKJMVxchrXRFVu8cf4pHKfnty3BKrBKhxdclW_HeBTRETEMqtDDA1|mqM55elwmlTMojSM0F0AauNG_RlxGueBxZTv18V0D0c";
        private static string publicMsgKey = "5NRLD2GccLQdL4SwZuZNDdNZ5ydGAkghSzHPZ4N6a5gDhIOJCdkCvIF-4YOc5wMt5fkEaJGWi4O2-zhJvUNuiaysL_hmOXxgOiku5FhqIqIq1Sw9TnFO0MQUbsxZsyVz5se0FVqJMaU2ZCe2IdOSGARMQCpqtmBIzzaM32gvW1jMrbdNUKE6QjZ_1RQwGdRCM9gUZ_hHGCJ22jOQbBlAYXquHFab4uup51FEMZBsvOZ1v2RpXhcfS5MI-oHK2BvDZAt2LcyqPaCmEcWx16l2UffABQYWEBdex8o22_CUT4EJOweD4tGPa1YaHiJvFCF2fDoELJxDIWyp7vpWfiBtCpKaT0upbeUyUNNt0eUq0IPBJ9cPYzsn3Bk5piKEjJY-NmjJDmw0s5iFUGIrM6clXLYrGjByydh3gtSqZTQoXJdfc7bJQNhrTxQcKCITcVpwmlG1WFTLg9sYACgLZYkcNCR9WSIaimx2_PRfW8o6rZUlMRBhSEteO4IKgrgGYDoczziSLDoTUYdMCmQe3udjH6PB1HMTL3SU-StrreAckYd6k5hLCvs4-zIRyFM3AsYeS-sYyLocjIkakASq1KgcZUStOXpbyKckdKvNT3iQgNaIpTJ7I7fEjrKJV3kghDwNVhdX0dIWLmiXoTEvijVHXQqNbYlL4wILABGghtWGvzpbXxVgg_aHxCSfm0pKSKtjMdmTQsQyg8STLUxQfkWmdWt750tj8HEZ15YUZqhpswaJqNaE_XS7OSzAfdEj8jx_XkgWZ5aepNVo2VCICWlYIiQ-jxoZSEqzEbtKDGvFmsI8LVZJUKCqu3FIgbUg8xM-1PXEOLNuKqlh6UQXY3VdPSk7uwOIYrwFfKLB4GrBNNit2jPBU5qikWdBOtAFboOY9neWPOTCYrqxZtwa8KkLbBGsp0y6CTxhQRQUvIk-wWWDlPUCZbhu0jWXdHc_6SSKizOt-tKHdZzBq5lifCq_6ePM4pF7kUfIEwFiBvt4eMwokmo0KnGbD4hoh3mIvzfBnnNAJelTiPNPGjWkWLaQ_aB-5adASgApe-NJYEGdkNyMXdoqJ6pFX5aupnE6BcpFC7s8BRtZmapieFWVL2Q-TbgZbhUF7qYXlHhBS8hI07YQPRWfNQZ6Weu_2GeueQUzwGteBGOZfXtNZ1izsYAahDPHhvTH4kQm9SUgZRlNzdKK5QqulOooVRUfD7Zx4HaZOBebgQFEqzNDW0dgu0kzpzfKxFsJOHkxw1a_U0hGP5PMOpSJTgaeWLo8zFSgNzgKlBRyDBp4SmaZ-WVqqQGjgHMW_ZASQNE0ISIi7GOSVnZ8xfx9mOGS-zuGh-x0ELWd6Dp-RHMrZBq5uwY0CIegF4QDG8d_pfwntcReOFNpy0dqrFoW9iEFeteG--YjKyho5ZK8D3fFYJC17XseZqkddGwJCTNt79Qv89dGVVYmcDR87gWpXSJIKLUHCoYqqBqkxsSrpzwZvLF6OdgX9_N80YcqBOiRYJseELsbSLgdWvZ2cSuif0hG00uz11gpqcxwZqEvoiZiU8cYLfsYygQDPKZwiaIiJOO3IlkGjbWPviU354iLLogY23QEazBuapSWOXnGF7KajTt4Msc1lnQ88EJiYONYjfg20Ocb0zkOlGoymBORRsGUUFoAO3jGQum863MMLWKNTQNl7OEuUrhyVLYLT0Ck9jXOWaUbWhtoUYixVGgZUoeft7K0d3UBN6qbx-woXitlSrBjDHurDLU_auaJXqWXeyVLdiSOAmwYTzQY_1GT6yPDzZc8QbybOjx6WfcDpUp5MLG1_FBlGvLD9uq8_6Kq5_I3KNywFlRA_5wqn3gwEiM-EYWFzzyWb8thMmOKiEwrZBKWHRUPpHaNlhXCChMCwBtLU0wMEQQr9wOslOsdhzpvufZH1gasbkCliScArxZGEbQlS7K-8QIVVxkq6EcEf-dvaZu1lDorWJImsgc2o4G-AMMYmOuEusd2aWJae2w8_kSQKJMVxchrXRFVu8cf4pHKfnty3BKrBKhxdclW_HeBTRETEMqtDDA1|mqM55elwmlTMojSM0F0AauNG_RlxGueBxZTv18V0D0c";

        private DistINKeyPair keyPair;
        private Random random = new Random();

        public App()
        {
            DistINClient.SCHEME = "http://";
            keyPair = new DistINKeyPair()
            {
                Algorithm = DistINKeyAlgorithm.DILITHIUM,
                PublicKey = publicKey,
                PrivateKey = privateKey,
            };
        }

        public void Run()
        {
            bool loginResult = DistINClient.Login(identity, keyPair).Result;
            Console.WriteLine("Login: {0}", loginResult);

            DistINPublicKey servicePublicKey = DistINClient.GetPublicKey("root@192.168.1.201:5157").Result.Result!;

            string recipient = "demo1@192.168.1.202:5157";

            for (int i = 0; i < 100; i++)
            {
                testRequest(servicePublicKey, recipient, 1024);
            }
        }

        private void testRequest(DistINPublicKey servicePublicKey, string recipient, int dataSize)
        {
            Console.WriteLine("get DistINMessagingKey...");
            string recipientPublicMsgKey = DistINClient.GetAttributeByName("demo1@192.168.1.202:5157", "DistINMessagingKey").Result.Result!.Value;

            Console.WriteLine("generate message...");
            byte[] data = new byte[dataSize];
            random.NextBytes(data);

            DistANMessage msg = DistANMessage.CreateMessage(identity, recipient, recipientPublicMsgKey, data);
            Console.WriteLine("post message...");
            DistINClient.PostMessage(msg).Wait();

            Console.WriteLine("wait for response...");
            DistANMessage? message = null;
            while (message == null)
            {
                var result = DistINClient.GetMessages().Result;
                bool verificationResult = result.Verify(servicePublicKey);

                message = result.Result!.Messages.FirstOrDefault();
                if (message == null)
                    Thread.Sleep(INTERVAL_MS);
            }

            Console.WriteLine("validate response...");
            byte[] responseData = message.GetDecryptedMessage(privateMsgKey);
            responseData = responseData.Reverse().ToArray();

            bool isCorrect = responseData.Length == dataSize;
            if (isCorrect)
            {
                for(int i=0; i< dataSize; i++)
                {
                    isCorrect = isCorrect && data[i] == responseData[i];
                }
            }

            Console.WriteLine("verification: {0}", isCorrect);
        }

        public void Dispose()
        {
        }
    }
}
