using DistIN;
using DistIN.Client;
using DistIN.DistAN;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace TestApp_B
{
    internal class App : IDisposable
    {
        public const int INTERVAL_MS = 100;

        private static string identity = "demo1@192.168.1.202:5157";
        private static string privateKey = "KUa41eLuTI8JT8D-gh_JW5a73Ll893KXn0-W43yh5Pc|rkocS6A4HPOwlcBIzUXAx-aSo4A3zvEcvPw_FeJb5qRckVM3oWaf4ptPBgpfRkX_U13mWE9lOdApyS_-AizR0g|SYQBGxiCwQaExLSAEoVRSxgEEYIJi6ZJ0MQhCydxkAQoySRoSIZN4wAMGLkhDAly3LRt0YKJ26YFmkgSEAQRlIgxiAJQIygG20QR44iBUraJAxFuIckQQ0CKJEGJwKRtFARuIRlAyKAoHDEKgAQpyrRRGBlshIZgQrYAAEElZBAu0QCFRIQIUDZuFAMsGjkQyiJlQ7QhSiIOkjAkU0QEESdx2EQwAiNoHCgIlIZAy7ZoAkaS5CIkQjSSRLCB2JRtG5dNTLQlDIRAyMBFE4ONoghgJCMC0YaBCUVMoLhFWxJN2KSMVDRu2rIwESllgUQkISRkAbBIILFxyABKoEhEpJBFHCJoC8GRZBhOBJiEkjBBGwYmAhmGILOQAwlNEcMBGQME0TgRoqgEgZAoGrhEIRSRohgyyzgOUqJtizQgzBAukpaFY8aRCCGA0pZhCsKFggKCEARoALlQmwAIYDRtCJJpwDSC0MQBIZCMHIZtGKlBYLZxAwcQoqZNCTZgGKZgYCKSIAKKWDaOJMklgCAJASgMJKNRE5JIFKBIEsYBDIlFIzWAyLhRGpcRTDhukoiAIUgsWzaFETEkxAAGSTJmmYaQCrQQzCSFCEgB0iAswiZgCYOMBLkgkBgBUKAMAKkQ2jAIlEYQYxJG2RRCGqYNyRIKUEBsgUJG0jhgjCgEUaSFQbYQCBAFoUYEoziIzEBsYaZlIbVM5AIw0iCNU6hFSBQsIjaBTDBylIBIDJhImYIR4KRQZAYiCskFoaIBFAESXCRlwUaMAihqipSBHAMm0SBKTMJA4jJQ1IIsoShwU4QwmiYOIiZpGIYRgEAKGAmOSRARGxaFRDAkGhRI4YCEAqEhIjUN28Yx1AQK0yJQISlpGUZhFBYlBEOOCQGKhChQ|S6JEGYYIALklACBQA0hm20RmAEZkCIaIBKQx4kAxWiQBkBgFGSVpArYkUSRm4cIECRcqBAVkpABkS0ARyzgJ0pYBUaaFYCYyiCJFk4CFQiASgrZtI0gJBAAsHIRNEMNAEBMFmrAxBKZwRCgtHAJwwUIlGiNqEBkSAoZtCDOAoSJwlCBRChlN4IABTIhtE7INwyhQ4ESQIiZCWBKKGKeIWxJuEkhJgcIMCwJIkiQq48QlpKJBmSgiEqNxpABMDAmNmiZO1DAsAchlAAWSQ7AtULaAgDZoQsZQAIZIyZQBIkFkJKhJAbmRWDiNEiKREzEQAzhgIjcJzDQIwEKGHJUsoMhkw6KJSjAx00QgVCBBJDlRIAkpFAeNBDdCIqZpo0RlIEEikIRggSJGCadx5DSGRAaNCBIyEJSBRBYQW5ZMnChQBJhIEhUGBDRyITFImiKG4qQFhBgtiAQOSKJRoICMAkQkRMJg4TIkS0ANGUVMSrKJREhiAEBxXBJF04gEY4gMUZJgAKREyBJmYxJQwIhhSQJAEgREAJdJlEJyRBBEoRIFAxEkDCBASCSNFCggoaCMG5hxIKGIITlpyDQCDCUNTDJG5JRhIkAgCjZSJCYiAZMNGcRgZLZkGSIB5BAIiEQyUxKIyrJpHJSJA8Zg1BRgI6hFygBQIQdwY0QSkoAAoQgJFMAF0DYlmxBB5EIOoLKEEkOCRAYyYSgIDBKS4LaRCUIhAAlR3DBmkzhJBJIFoMJkDIgAmogNyiAhAEFxFBEAoTJI4MYxUQaMxAYsyiYsGcZtk8Atm7RFnBJp24KNEEJCwwRqEKJMmDiKmoiMCcdNSYBom7RIFIBJlLRwmahgQjYxBANEAsMNyyQp3EQmyAgiWRQoE8VxCQUm4TRuCQGOxJiEHKAgDLkhGZgpFKBxZKRxwjIwEhJFgBQGYgAECsJIwggoJIExozBNyjhSg4BhIQQmQ5YoSxaRmRguGMVo5DQoBKdAIhQwDEGGJJYIhARQ4UgCRAglGTYt2TAKi8gx|5YzTrfbmZ9mCrCqk8K13ft2gCXnzimoJeaSBCUticzY5sAUoE-_ZT8IgfkG0nxeacPHozA7KG3-V5772OE374krZWJcDCNwCb1rPyuvQzlWojisRWIdXDSmkp9KwbW9mCnyizVJWUjZcL3JcFhbIDJdoK5rMv-KTbio4tmutiItEJlSaXDFvvkbf2JD15VoUyvGOs7pRFriu9d42fWtkJhEWTLVq3f2iojAqq-ZYJC-yfehbqxIwns3UwdO8wFS0OZb7b6Fr2xKMTaSSSs04IhXJY-CFKofuKDehUWTD1wQuuXWBEBlaWBUa5ymd0KVSAzH385hl9TdDpwk9JOg2Gjwux6YojgC7xudjZIqbhuOCkdhtSsL4jGDlatw9eziW1w1avah2WsctSGP-R4gCNQgZfjjHNI7YigOMwySzy3rR0Symj3ZVMYEp7ufHqo6MwSk_4I0paFwLyNtCW1NTXJIUCPmuTPRiunbnRaAfA6i5iizeazvP1VUnCHYLsy-0_PYq8fyEkJgP2YQSE8vVk__TRoxEiBUYIOeFPph3zV8_agP5VeLrb9wWep889vPucMKaCkj5-HndJN6G7NJEI7dqexqWW9QWglbO8iArh1yQE9hFEOp6krqnxaw5LU9ch30O0leS2a9Yo12FVKABZo48XSE627A-PuCmEEFP5l58NnHg3wCJ1Td9-izoJjMDxZ7t9pqpjZeUjQbIcwGhNp0kQaGYFicSsfOI7Jgi8e8FdS9I-yfudjlFL7BMzY1_WSZssjXIMY1lCmwu8PBQCvdOsSKy-EO3KF6H2ZZtZCt5LR4TiTGiqniL7hWqNi_xI5iSimw3WJTBsdsUWH4vxLTFlIKNbGfQJz7FJEkxJ380PPjict2X5u3Px4JqfSYIkv142PRJhPucqFeANdeyCRQ8hN4eDMRf3pPjDpJUxtNZV7gnSq5TvRiojLkx0ZT29Q-HJgpbUZBdugD79dbX1g36xIHM3tGHzd1ozNGLjqE9jOtAipfwxJUg_absv4twO29FU2JmMqd7FeeEBc3Jo3Mr0aXnTIdZDx4nEkh8_NBgHADAFpooRWQjAAHxwEIQVI_cclwUhbJaQA78GGvyh6rk7RVixxxOZEiqfysOE2-1g9fIw48CZ0NbvRVEBFkyloVoMAzC_5lMiQdgLZvvLs02cK9_Qu2mrzr8ijcgVBMGXVbYGkTilNTg4jDZwyaynYZaVMZMkp3ajez2j3WNab__7-MGXd0n2Vbi2nxbUooCWW7M_2gUfQpJTmznfbTx2VDAB3l1TCKGCLv7llLLZsArCge86hyGwOSgomHjiftSvRsyFjgAvFgHunW-kUnQGen4ociNkl-ZbpcNtD5DLCm942jAKM7UZlbZxyUWUUHcXpdsmY7YDu6LPQHhdE7v9WAAnadReNQMa4guPB3YqkC_xTrEbUejyTkpMK-Xn0nzzavZW1mR5kvO10mhUzgTQl4jXRaBcJF0w5L3z5eAXhne6-WizbRoDZE1_NlvBcsphWk8_2xg2io0BulG5R5CCV9Jz6lGPXF7H6A7BqRM6St5rqQoBvCnYyq_hEfqTu9bpHlzJ-ERo89tocGCwek38HYz-hU1E96ZtPIfck5VG49Y8I_iOB_z6_TJU25ERPShfjPvj5RpxvT-6RRr9y90Mx60MbV2qn-qNXX05PcZI7S3FpvLKNoXg7BjQrdEjOtqSl0vlIrWRQonq8Wo2R6AUOo8olNYl571VL--jOYKhNkvI_vIbZknSa_Pw-9kwLrI_gn8818U5mRDltUPPyI8Bzu7l5c3U_qneuUpdmxsDvhOFdheKm1WwBDNTGK4Rax5hbdeQ7auhDTWY6pJyI8h5xYwNH0cbDNcrpWaBmCRH767cHVoUWbWaMEvzMMpBD7uQ3WIQpzMYzs45ifp-YVTikFKQyN4ewgRKOG9YpJw8m74XECe1Z4b8q1mnNcTo9QeWUlgJMd_p9_8AuI53DI5p-nNUoQP0Gd7Dm909nJlCGOu86jcSS98re-mFpRbv5AdzYnY3WeyGAEN7MgQEHspJVjByc6YIxuatQSNk0qKE0_2UbwnFIMkwpXQurgoX50mT8HnY3vHiK4Tl6En3U4hbzyX6KKLNCvvaK-7QODX-pTue96d4AAr2ZH9nmQzTjWNfSZTsL2g3g0NYPzjMFVfMVNQtQWciQ_FfryccdwL026ValvLaKd0iQqes9pQvCmPdiDE3YNqQFuOi7NrMYUZDiRwq5BWto4dI-oXJvO7z25HuehPG_DxjtyFaoOMsqedMBU8YXU9xvmK-12CK6w7-VBEi5sWp20MRgvGG7KEDctrKwnCkQ6bYdKwNl9Ohx5ahSBSMMI3OR84mwgBErpJNNbHai2HNqGCNHWsQp8sM8qHKK30nAoHKa4LwU4YviScdbcwMZxKJ8j38ybcEPJ331BWz3oQvKoF0Gh0TXgX3U_0XbNRVikt61qKwXelUjEZG-yH94P6z3OyVB9DBSoN0z6HWu-mblgQghoePsTMkbyDXNSb09HoxlbQRaFEuskZHc1fLm3tnvLWWvZKRJE0Oid1o7lo0VXI5wSnhT2dvoNbd0vLh5XiX89q4xRxPOo_VwyDTzmr5Nui0Tv1aoh8YVNJ96Fa-VGaMXm5DMYTuQUnI6bjtMM577bSq2dY8gapwq4BNxEUAh2UI__ToETzJcIRA2i5A1goCHMYet10y7fDM5m_YuuEzJE0x0iKqQmjeEBWzCdcuA0pInLCHKdMBU79BX50REjkrd8s1xCkO4PdUrgzk3nne4dxF7VXQyV2DirjNPeF8LK9djEVF3Ge6HbPniD5_x3juPS1DdX9ozDSdGGAFTTnk4Y-MmTHnWuSZamaRxK5cuDRcTD3fJyjdKjUJujRwHdRLkGAr8ncRcdyfMPUA5Bi-fe8R-GSwaPTCrCj3Wi3tjoK2h59pVDU_F68VbUuuLOX3TFPy3O-UnkreeRHPpDJj6gj5sfO81tGdJajtChj5GEkNdMXuUFhDmR849nM8dC177TfX9L2REdU6EQH4uXq1Ltqpbib1bOWn8cXAQIiHumbJDQf_whneTmf4LpE9yJxBDwFbTFLBWuZ0jHVco7H2Giz97tN4SolUvVUwp8ofN7CfoevTgdKUR-TXtjbfX_AZPfPRnyHcPDjQzt9TsZTOm37HmkZUSK2dmcdmSq15KpMdKRxmjmsigPU6DqCDC_vA6trVgUfPa3QU4i0YNn9GH9reWT2zj0esX1yNz6F9FdFQy1ovjLS4MF_NrqGERD2Zn-pQKznqfwNQ7moJUzCwn69iIShrtWNku7UzaGKZOn_TDgfC56CKP9LcT2Pzb-34da1QTcxRoDQYfIi--9F77jSUtCMDzDpxINJg55SQXujYC9-FIyB-7NTR7HLj2FrWjwnCiig55JBseAypgEwmtHdqxXXeC82e-ORm0yPKQbgdZ_ELnP6jbmWgoPXTUXMwwaYJTyZvSr9gSYV1QUuSHAEpIuMaLoiTEgNhsdpz-zg3gihqmOv-X6dqg-JWEsCvSzI_TSkdkfynfgVDuXgUP6xsCEAx1KwUERT5Nwowkv--CPYjcBmA_UXVJ5BKSev9iXYFu2ArpTfNtoy2dmNRKoyVRS2EFmIPJYrOL7Z-mdCe503UbAGZheP7rn2igRbZAZxw9_6YE18Y4hv1UORT6uI4q-3X0yOVT2P3apesqut-hQY9IKpashhp5oIjGWARDz113XKqsTm3sD5Gnr6HSC--Npmu8HM6rOZ7P-T_z_K9ZdWOb5R07vD98A9R6OGfEw85IIGQqgfUOHcsxPX1quR-rq2c4SzXb5k54-YHks8Ph73rtXmW9u78kO3Fmm_XytlwvCVbSBK7kagQGBevR2akYdQnVgbQxuSQ8ONtYbc9GxCF14izJmGPMZFhc0mT0fAJVISS_l_MCImxBPQJLIheHw1UrNVcxzUIs9bbVX9LzLZyDih95jYNaso8ywGfHQVlgE2qlbFnfLIQ-ALTEzw9hUPoli0exfJo746n7rkqMZSxuGxpDmJWWJ-n7fUeaQI-qLJxvGorKSnEahIk_BSiLXaEQRJY_dN8Tu2p-2SagY97ZqUiBi7TviOFte9flA9MVBhwE_HjMGh52qgZ-1tzub5TUtg1WcUpyniieIajbRSEIE3_6iDlQ5Q7ueE08acMnUOimlQ3WbjeYHKvzGsN43DxTj-pWP27gjqkq2CtlwJiAbVzwT9oOWBcX4_j_e9x09TTE3bhNn5DWphT2f0Jnszlm805cObXOAuTolJl2U9inakBsUJNm0i4BIMstZp3kriT4OtuT09S22DgfLu86WJEIQ56Lw-mq7a41yS0G7XnASiqwuU2A71pu_VwD7gpxX9BCNq2JYyLLzqy1eJ9UPE13tX2CMugl1MA4uyf1zzBKHeBencmcgeyQ_0slAVUtTQZA";
        private static string publicKey = "dC5dwt3JX0UPqMrx6CnEbqPpqBZB_BiaD9xZr44hMT0|T8r38aRaxeygLZm1DIYnH9hdds6VeZId4Y4kIRpxJ_ZmPk9EbomC3RvnHP5_icfHiwLjR2GE5wbbMd4V9wEVsbUBK6YPkH8IdlfJ4Npgjvwhc22_lOh8INj_iGDaNBiBsyTEIU1uUvjY31VEI-Y4NKSGH7m8NWALw8AgfY_d7jVb3WRWWvuoX5CXe4LxkuZkpdX8MCLnWqAoOpUHYvoI3u8eyc32n4_olTeDNu0vO4Iz5RvhCF7TxRhbtUBAb7UhIq21uB0jHhx80VUl_FiceAHvKLBhI-OCjofITyj1JpEyhJgeDGBK-ss-uFL83Am_U9cJjic2ZoGDT33gEMUEzTuc92sfkTirsjA6k4OkSY3gwBBHOwRUhSyOT6oBgY06rIxzw6NQ31pamtDbSyIYeSmV3Ce1MMjWzmXkdN9iaLeselTbiNzvPt8iTDdoLT2-UFq37GaxtVYdJG8FNHHv7_JkgCJXNLyvD9pIYU4Jp0thA1c25KBVe-Fo3YcuPt3wX4xD4enwzsCVGRHwWbO2Ke2y0UTrbXZlxfgrLEu8Jo7rFUsWyZ1NImCzcwb1sNDyQ4RmxwlRnti45ZGDZFdmYRxEmsD8IGRI4_XALoLjVKtBgJLoFo5Na1IKm6iztOFxss0-x-sMQ2JDbH6gTYlufm-4lJL4G_P-IfdOTEEEIHxannPtcs-WYIHjevjilBRcN8IBvmpYNMZ9I8uv7Hs0duCkv8HpzFUOHvGt1dRMyjMKgBW2sSrCzJ6n4FlynO5Ml-YgrCFfXXG6FTCoAEeqkgfvr5mQ-IUqximLOOeOGRDZXGtzFUx0Cm1BRJsFz-pmHauysq0ENaobjqh_3p9jI3wV0dtyUZ25HF4PI49fPjjwlBrYkHCdEICmMfyGo6p4H_Y-U6ssRvOJ1Fd6qJ23O5KOXZAGwvE3RPHMoaR87WFjZSkPd0OikHuToLLl-PJpBP9uLEM48n0RvbZaCTAdY_5yk8OcMuGbYqE3Qvv9A9E_pZP0hO86Q2OtANa4UGhBQ8t4O7gVKxi-zmoneM99n2GRF_wVHZIUXyhqvHMffcJjX7gEyJHt4DFsEyNj8t_H_tTyfuBxzMV88KCW04Bu5kHRkK190wGW-no0JHgQVEMkQNblfHqUEobzujqYgzz4UUe3LLSU-7jdK6zuHwuTEjBjm4UKAplfJ0yj-8TOfGWeayAf8WI1GwVbfPbKIedzp6Wt0IQQd5x9vW-X6yl6uXSIBiy23XZV-XAH6p3LGQavYElmNhXD6NGxBqkkxG7NYO5VEanXK3iypqFLYKhMUK8XfiDtjfIJaFkK5MvQCfo38h6TaQ2d9joSvvPDR7di5zQ5Db6SaJmbL0oGe3tguutldVMs2Huhhdu3qvgKXgjCWS-LSlX-lHBaH_T7_pTNfMwbn660KtM_vwDGo9J_e5Wf8EcFic4GH6n97C3oTt2QTFoKpfdhjPrJs0Wrv5q1UHNelLW0mIznnCSiSaDYZCC2U-JhhkUHxa3dVgqpVJ4alABU4ZLeRaFE7omslKl8uP9gxhZESMALZ13sKgeoFjXvrBykJJ9gV1SOkqYJzhJJyjX2lrj9Oz9eiNQIkmV_5MJ_FZmZQrlrMTrWZj6VFJFged0BNWa7d35vMw-SjjIO53rCqY2qZXf4XEH5CyYOsd652O9RMTT8wWaDmWBJdO1WkFQ3WJtRzEXjZx0waSBIXdKHdT3KyMA41NaXkewH2rayBffrbSgocpkvemi6HWO40a4AUC2EEZDHeOc16jW2h9JPVjrU_sqG49QuqYgcWQXGtGRvhF712-QUGUVOW8OrUb0tnM4wlrntVMl0NBO4BSx9jLsQg-25lw4z1EBKNRnzx55rQYHx-YalLjy9_KilXf6iAp237dbNk2vQFU2u1JY6Wp3eF8fHRlXP_1zBAp4OtPt46vpeBf0-YbZmcYRE0KXa2MSp2BRbpv5OTtdrpQ5KUHzqT7K7wCwLs0VrEZPc2r6fmeui_n0kC_OcMA3h9_rFLkhtRluKIt7KJWC9-bzK8SC6VZ4jGkuI_iCKNKILUF-W38e1-BP6CwyZ6AgxMX0csKKeS291s1fN7b25bBnhq45aeDjRqEyxcsW1LKmUtXkw3zzPfQpvJGtGEykW5zUa4CYXsGKL2tw5YtU7Rjpm37afZtf9MLGkg5ayF3SJCTFJr4gOWrRI6YMoBkwJmFLaLUH3A6ivwYva61gshGWau8H389lvaxTt-8Re8CsmClJy6w5jpfY3S6yV-QTqahCaIVmPzuH8O2vaFYXkQeBaQfqFkqAhxGKD4lpNp3OkLD6kt5jrq9_nQvfOQAPG_MXaB3QvHBk0NX0L-HpDUKFBeeC7HwrXDsfMedxx5ayMhH0RwrdBQCCzyksMU9t_F2PytBypNb98KzZ2O6h6O97m6Vo-Dlacpp8RB8uQJUbg3EdL_zIOln0eXpEY0Fu5gRk7qA0vT2piCItq823EuZ-cq9ObpYsJ9axeDioBLyo2f_lEiBGHZ6OwKKkI6DxON8g6xvx4RpleBL0rQnmsQ5163-YgjEwY6LjS-qTKPu3blPOYSQZqEmTiqT2j0AnpC3HwTmCBNu83JTEBQm-7zuq0bvs7W6JS3Uf0wzO6nLfuG0nuX8FO2oKVqVnve4prpgzd57dhSgzJbw7ewwj3tO6gY04GrZxuIc_1mWAplPkEEUe40utTRpvN7SX3UIAWTWAVOKKfOkQz9PlK-NyBv6_4NRbH6Wm-XQ6KHykyfWoUynRUy62lQPCFcBRrvUIotWQRS7paFwBQRs1FBQ_nAqpJ7Uocu3s9HYlbdE6t96ahdCiTBCHvt2FSZ1-EXCWmK_NonUfq8B3UwcnLjyLqnCSCBKiHQY_RfXYA_ttBihWjdsaoBoj9TQWyaAIJ30WOFboB2xSvNjPMT9WOkkmGsR4a8ZDOObj6RNretxaEN9auCSIcjU573jlO8LdS9tSorjDTJ8cjgdjGAjixHF6Nbd4FRuj_2zAIVBFh-L-Dx0-P1W4PprX6PaTwjr2O1x_9ESlkNA_xSdopNLnvuc_V7Hk5OQrEJrPztQc48JXYHKLOIRjgNFWZpND1nhYaqmVP3fsBKAK9TVxF7HhcJTscPo18uhE5k1KtF75RESwBmle8427Swct5mrtCFjheWkXnu64LQiqHhtMfxnCFWEPrEmnj2EfCq9s4Ejq5WX22gHJJ1DszFmFRKbmiFPhw3Pk7bsZlXJULmB6JaM_L2Ks4JNEOk7i_wMvz_7FjyY0IGQmLbAFIEsyB429GyivZb-iWSAZSBvrfQwOhg7BP0pkZNk8Eggjqz5GxWg9_ZlXpEk-PmVgPptS-5cqrDfZD_SB0m20UgX0GQSdDU0QMm5N3oXqQ5gO7X80ct-KeQnFrpd8Vd5sUKv4uNJRWOKuRmQ";

        private static string privateMsgKey = "D9cGnAcpdfyIvAFBJromJ2yoA8Vk6Msb9-WcwAdDbwJO6nQ2GMiBRAWAMmUx_MItGalT6Jdx1fF1MzFr4TpQbAJMfsNQ2TJveRkCvSpXRrYu7URWxGZ_0zhRH9qQMGtvtIAwl3inOFzDJAtJqKbDaKrGCyHCgCIF5VWopzS94TJB1SR-qba45Lt4x3VeV0iPKvU78oxH7DiESVow0kPGyKlwlcEDMxPIGggYzYXDjrUMgNqHkIwn7OyckrxslMhKLxBekaAJP_SxGgMJYJMi0qI1BTsD1Ba2MGMndWZjXvC_-lJlgVB4Ywlyo0WjcpvDGqS7Cbu7YcOiVkYe41yiTQmjSpK_UWqfqslqZLoh0wLO1fwz2BbJtuGs6-Nkh7RJT5FJzDhQW2kNZlkzaKbMomkqRHh1oddO12o2F1lkVEkQfSw3TZtRE-YoXlxWqWAstGiXPcu1NsiRYRaVaMwaZah_00A2qeYwEFVS-0vCA0I4c3gWtZt-flIzImsAFZk3_2sZWmeh4AvBx6WRxRqLUPFFkNRcN1I8GWSmTTmXp1WXxTsq75XOlzubS-e4W1YKpZwSJJOjKyJV7noCqCQUcJxRMagdCAguRHyspwi8Wjad2MkkDEd_awCIzTCzLSgNGpQsMTOT4VuML7xAHyG3x2nCSXjO1YCsW9EnH4EmV5c_HqBGExGg28FGGKS_t4lF3dshB2ORgfsI5TmnF3eKu7vOwGhEkqIQWfQ27JNflpWeTAiDFLaJkOUeENcOEwcVpyEfEqFhT9OJK2uZ8dSPJqOlJpxQM9WNlUqqkQuJ67cFsAwqehdh-saMIYqD_oVyzzpUalRAnzzMTTAIsCU8fowMbzaCQcCQk2bP2XOXRedtT-KBSZw-jTo4XNC8jRt_t-dTShBcHSOPe7V7RehFrPeI0Ysjodxqn_O2sQpAqkiC-mBeIZUuE0ltyAmFd4ZlGMKHeNLOr8AI2YClMTcYN-tta6x0ZXRR1-czAYBmNgFysHTFw4JPLnBoUYR40hgDpWmCjmrHkvq5IcdYOYRPApkX-bdP9RIWSsZFBFAkBXRU-HkeKoeO_8a4hUuDIuoz2NiXk0MMTccpMWlZeywtS_FXtbalh_GxgNEupmm24_iQOuhsi4KuJayh81x4WRsAqwEtRtFgkJmMNzJTlFylH9K8j7usEeRgKJFs_7VqvzZPDVZPSOwXazjBeDiEzkCTzDqwCbw7HmGChDkK7tqevjK9cKLPrUqRimFPfNB7bmDBqKAvMVdY7dIC3URxn7NSicR8vaUKcveZtssx_hU4_TqlfhhK8jkYbWhYeAew5_O83vSa9pakrZZmy-d9_MkTs9CV65kKqxZ_-bwyVlHLTJA7hVNO1JnBFHko1zpcCIySFwwVUvtC22ep2cthoGAPUad60biy3Zm3dSga_qBd7NWyA4tzjBpH8pO6jqFZd3lzHdFXcJCXRBkyUBgZT1tyJ5tRcMDDhxGKjCMZ1dWohrGvVcoSLAmTuthswXQB4Jh0LaiIePdLSldwV-lFLVovF-tUqZQXbbzOexTMgVFL0vOYu6qDLFfO56O6cwUSW7nJo_IvGtsFnACmdxK3xxUguerJq-kTXNAbv4JXatUn6aA6vLxD-6Ksc0ghKqCVdLNpKJkn2gTDexYm50Kei7Ovw4gwijECXIohoHsJ02aByKCzEvKMnPrN76gaGsI8HsikvQQ3dXyfeFnCFYwXvVtl-EohrllZ9pgCjQHMuKA3LVlC68I9rOQGc5J80nKbBnTLFdQak0JFCwtggNifMUxCSSZgPzSv0Pl8FERwdTZvzhqk2nsf26pLbWCWiLer-ZhnOtWDpexWe7FhRkvH74GibFW4MqFzDszH5nTCnJZiHUWudJLM25Jvv6A8FCVbmIDJ4bkLraiL5CkgH5JwYGacJuNKIMFGU7K43bETKPg4WgaE8gsXlxlEfmNR4NgSlGhB2ljFMASQ2fkN37GG27S1SzCtggxgVuzC3EOp-sQdm0l8rZtJ8wakstpi8PtCtVJG4It82jsoL3s5o2KJgVFz|WUkCPDo67HrSOckYnpMDgBddzQSW0GLoDsfax9Syg-U|hAXgRdwpXgdcfanFQUEcl1GKY-AJQ_T6dmLi8GJL7Cs|NpYAzudDDkovNsNe-Fiw6GxoKaLJT7U-eIcwiPVx5TC8eEV6amxqRkzFTQukIMeRhVkqPOU9mjMVfkldxxPLjOe4uPBKupLK44hrRSGR3Lt-Y5mtLpQ54ZRwAruy-EABpGkEHPKN7it4lWmSNeGm_FZCAGB45UOj6BOOFWk84XcrtlmfjwTAQ_uNw6Mcn2EFVaMe8PkgOrEIhoB3xuI2aCEIf5BCU4xiNTMbSNQ5aBPCBNhM0Vog6hW-axOe-JduLFDJBdYNTtCbq-ymhBycGAmtBhuyOGzD6YdizBhES-ylCPWjirWYffMb4cg6K6lUVVW-ZrABdGAMxmh7ipBsqkJc8OvIRIDDx0G1NAiTV2IT0tOiOEcWEIbJNkqP2LUlEbyJN3uf79Yf_pds1ap3DWyMKSOLg6GvN4kfdUBgLlujs6KgFyqJZcVDiQdr2dsrcwNzf3gbU8Z32JsIEQgY6BWI0TBfrFdRJPE9hpSzPcpSyhucEcSvOFaL6ckf1sSGCLgdKOq8CdfDofAcKyW4Aau3OzgxkMi0lZElbvFtJnFK-fdri2wTGlZ6eeBNbJIDHJIhrnuhcMQkBJl3Euo2OzJWiDscS_yJ8_RkgyIhJ5sPtgIBceuIgudJ5HsqT_BlBNYRFCIR1wkT9Gmr_ie4Z8E5wTeL-_PJxRCdX-WbgAYlw9DKr2BTCRFcRCSWFoddFdBqFOdES0dN-rq42kyjqnJHL-yMByN9q2WFRfM1Zty3vBGKugnO4RfF5ZYR6RAaQOdxwMK1s0u2F4XL7kuOh5CNVzyEmieO3QlnXttp8ikf58GWABtON4FUB8F7zAaohqLPPdMvD4aX7jWiP0Gdamdsj_UPwSB4eeaUXQZmCCw4g4E-e6PL3fgBBPBXgLK7B1i9S9wF2JoHQsfBPSoaDVl1MPwYArZA20BGIESGS2sB1GJF-Vw-56dy8CVA8SiJhNyFiOl7nbhcwJinRMa92gS8Z4sYXmWxF-QbLrpkAwuJ1MNK9CYzCBC3gwg64pPGC1MXl-Ze6TZYxtW52oJWiJVa_CNukreOSrgA1PYPMWMupRKAQ2g3NqyBa4JkbxGvuqUFDmlPkzFTNEylPwSQR_ENW2xcFEWwetNXURu1NkSoIZppATmB5rAK_eJltzUUGTmZT6AqRwSU3erIDqK8izWQaKRxsAJjuAtI2hZu4WiEWUOsLCKH9CmE0beZc2qoS_JMuMm6ZpC9htOfrJYFkkYRznx5RKoOY3IaYco11tCZETBmR3ZWFzjCStvEKbY9MhFPb0l0gWAgIRbCfEi4s-QzaWcnSFJNZzWVw0iLrnRbbYQCPNuPRlsrgNyAQXUrTtSQ5oBoyyyTqSwFjwfLn-UOrLg7ZNSeUYnKdxFfPINRpOq61eF2dmqnHmsR65hUnEurbRmIJ4sF7mpHJVOx92qjV5ifT2M88bN8lLgrsLo_5tCcy0aAp2K05zoZ0tl8LqxWN8o6TReK1ktCBEeoF2p7GpI-eXVhpCwetucCZ-FOqgooWnQ19SMwKeRdTnlxZPdWqgfFM7MwMXdwtZC9_mQKUAbQaJov8BsVhZQuTnATa1mT_nk0SCpo7wp7s7yAGKlaoqAgRVu40ParneZLbcpy-kCg97O_JKQZgnRn9ESpcpKlbHqdLdfN8RhVhsmV0mZz3jAwmjYZNbBAZ4bLgVNMKhOv_0p0_cQz9MZEK7hWCsadZujEyaih6-RRVZsBbppsucCBj4bAiQcjvPwtRRyj-wo4bTMlGhCGnYAckJQQxxOYwOOE6OO5CDW07hl13aRhMSo4Owa3V3YH3eWkCHWrX-YUT-Vy_TPI1yJE-4tp7wyueDc9ydCQesdb8DFVJ_K0A9iVkNhaocozeNhjA5xVNgkFeVVoo5QUppUIBkSHseqBGfSMAJdTSJq6UaUGAIckPndlklUMlxuM_whMUNupS6Ob2URyTQdEL0AztcBshAFWx_WLAqQHI7WqEzpCICBtswpUoZh3qNq-AwtYm2UnDqMDRDAhMltkEaC7vzZqRmN3G4yv6FA7wEayRDQD|k1ZX8rkk02l6RcpCGY2Ipl1LQXO48vUE1JvTlQmLIQU";
        private static string publicMsgKey = "NpYAzudDDkovNsNe-Fiw6GxoKaLJT7U-eIcwiPVx5TC8eEV6amxqRkzFTQukIMeRhVkqPOU9mjMVfkldxxPLjOe4uPBKupLK44hrRSGR3Lt-Y5mtLpQ54ZRwAruy-EABpGkEHPKN7it4lWmSNeGm_FZCAGB45UOj6BOOFWk84XcrtlmfjwTAQ_uNw6Mcn2EFVaMe8PkgOrEIhoB3xuI2aCEIf5BCU4xiNTMbSNQ5aBPCBNhM0Vog6hW-axOe-JduLFDJBdYNTtCbq-ymhBycGAmtBhuyOGzD6YdizBhES-ylCPWjirWYffMb4cg6K6lUVVW-ZrABdGAMxmh7ipBsqkJc8OvIRIDDx0G1NAiTV2IT0tOiOEcWEIbJNkqP2LUlEbyJN3uf79Yf_pds1ap3DWyMKSOLg6GvN4kfdUBgLlujs6KgFyqJZcVDiQdr2dsrcwNzf3gbU8Z32JsIEQgY6BWI0TBfrFdRJPE9hpSzPcpSyhucEcSvOFaL6ckf1sSGCLgdKOq8CdfDofAcKyW4Aau3OzgxkMi0lZElbvFtJnFK-fdri2wTGlZ6eeBNbJIDHJIhrnuhcMQkBJl3Euo2OzJWiDscS_yJ8_RkgyIhJ5sPtgIBceuIgudJ5HsqT_BlBNYRFCIR1wkT9Gmr_ie4Z8E5wTeL-_PJxRCdX-WbgAYlw9DKr2BTCRFcRCSWFoddFdBqFOdES0dN-rq42kyjqnJHL-yMByN9q2WFRfM1Zty3vBGKugnO4RfF5ZYR6RAaQOdxwMK1s0u2F4XL7kuOh5CNVzyEmieO3QlnXttp8ikf58GWABtON4FUB8F7zAaohqLPPdMvD4aX7jWiP0Gdamdsj_UPwSB4eeaUXQZmCCw4g4E-e6PL3fgBBPBXgLK7B1i9S9wF2JoHQsfBPSoaDVl1MPwYArZA20BGIESGS2sB1GJF-Vw-56dy8CVA8SiJhNyFiOl7nbhcwJinRMa92gS8Z4sYXmWxF-QbLrpkAwuJ1MNK9CYzCBC3gwg64pPGC1MXl-Ze6TZYxtW52oJWiJVa_CNukreOSrgA1PYPMWMupRKAQ2g3NqyBa4JkbxGvuqUFDmlPkzFTNEylPwSQR_ENW2xcFEWwetNXURu1NkSoIZppATmB5rAK_eJltzUUGTmZT6AqRwSU3erIDqK8izWQaKRxsAJjuAtI2hZu4WiEWUOsLCKH9CmE0beZc2qoS_JMuMm6ZpC9htOfrJYFkkYRznx5RKoOY3IaYco11tCZETBmR3ZWFzjCStvEKbY9MhFPb0l0gWAgIRbCfEi4s-QzaWcnSFJNZzWVw0iLrnRbbYQCPNuPRlsrgNyAQXUrTtSQ5oBoyyyTqSwFjwfLn-UOrLg7ZNSeUYnKdxFfPINRpOq61eF2dmqnHmsR65hUnEurbRmIJ4sF7mpHJVOx92qjV5ifT2M88bN8lLgrsLo_5tCcy0aAp2K05zoZ0tl8LqxWN8o6TReK1ktCBEeoF2p7GpI-eXVhpCwetucCZ-FOqgooWnQ19SMwKeRdTnlxZPdWqgfFM7MwMXdwtZC9_mQKUAbQaJov8BsVhZQuTnATa1mT_nk0SCpo7wp7s7yAGKlaoqAgRVu40ParneZLbcpy-kCg97O_JKQZgnRn9ESpcpKlbHqdLdfN8RhVhsmV0mZz3jAwmjYZNbBAZ4bLgVNMKhOv_0p0_cQz9MZEK7hWCsadZujEyaih6-RRVZsBbppsucCBj4bAiQcjvPwtRRyj-wo4bTMlGhCGnYAckJQQxxOYwOOE6OO5CDW07hl13aRhMSo4Owa3V3YH3eWkCHWrX-YUT-Vy_TPI1yJE-4tp7wyueDc9ydCQesdb8DFVJ_K0A9iVkNhaocozeNhjA5xVNgkFeVVoo5QUppUIBkSHseqBGfSMAJdTSJq6UaUGAIckPndlklUMlxuM_whMUNupS6Ob2URyTQdEL0AztcBshAFWx_WLAqQHI7WqEzpCICBtswpUoZh3qNq-AwtYm2UnDqMDRDAhMltkEaC7vzZqRmN3G4yv6FA7wEayRDQD|k1ZX8rkk02l6RcpCGY2Ipl1LQXO48vUE1JvTlQmLIQU";

        private DistINKeyPair keyPair;

        public App()
        {
            DistINClient.SCHEME = "http://";
            keyPair = new DistINKeyPair()
            {
                Algorithm = DistINKeyAlgorithm.DILITHIUM,
                PublicKey = publicKey,
                PrivateKey = privateKey,
            };
        }


        public void Run()
        {
            bool loginResult = DistINClient.Login(identity, keyPair).Result;
            Console.WriteLine("Login: {0}", loginResult);

            var servicePublicKey = DistINClient.GetPublicKey("root@192.168.1.202:5157").Result.Result!;

            //var result = DistINClient.GetAttributeByName("demo0@192.168.1.201:5157", "DistINMessagingKey").Result;
            //string msgKey = result.Result!.Value;

            //Console.WriteLine("DistINMessagingKey: {0}", msgKey);

            while (true)
            {
                var result = DistINClient.GetMessages().Result;
                bool verificationResult = result.Verify(servicePublicKey);

                List<DistANMessage> messages = result.Result!.Messages;
                
                foreach (DistANMessage message in messages)
                {
                    Console.WriteLine("message from '{0}'", message.Sender);
                    byte[] data = message.GetDecryptedMessage(privateMsgKey);
                    data = data.Reverse().ToArray();

                    string senderPublicMsgKey = DistINClient.GetAttributeByName(message.Sender, "DistINMessagingKey").Result.Result!.Value;

                    DistANMessage response = DistANMessage.CreateMessage(identity, message.Sender, senderPublicMsgKey, data);

                    DistINClient.PostMessage(response).Wait();
                }

                //Console.Write(".");
                Thread.Sleep(INTERVAL_MS);
            }
        }

        public void Dispose()
        {
        }
    }
}
